<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é ­æ‚ªã„ã‚·ãƒ§ãƒƒãƒ— æ©Ÿèƒ½æ¡ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .content-transition {
            transition: opacity 0.3s ease-in-out;
        }
        .nav-item.active {
            background-color: #fcd34d; /* amber-300 */
            color: #78350f; /* amber-800 */
            font-weight: 600;
        }
        .nav-item:hover {
            background-color: #fbbf24; /* amber-400 */
        }
         /* For Webkit browsers */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #fff7ed; /* orange-50 */
        }
        ::-webkit-scrollbar-thumb {
            background: #fdba74; /* orange-300 */
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #f97316; /* orange-500 */
        }
        .llm-button {
            background-image: linear-gradient(to right, #f97316, #fbbf24);
            transition: all 0.2s ease-in-out;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .llm-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }
        .llm-button:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .vote-button {
            background-color: #f97316; /* orange-500 */
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 9999px; /* full rounded */
            font-weight: 600;
            transition: background-color 0.2s ease-in-out;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .vote-button:hover {
            background-color: #ea580c; /* orange-600 */
            transform: translateY(-1px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }
        .vote-button:disabled {
            background-color: #d1d5db; /* gray-300 */
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }
        .poll-result-bar {
            height: 2rem;
            border-radius: 0.5rem;
            transition: width 0.5s ease-out;
        }
    </style>
</head>
<body class="bg-orange-50 text-stone-800 flex flex-col min-h-screen">
<a href="https://g.co/gemini/share/af11c28ca9f9">site</a>
    <header class="bg-amber-500 text-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <h1 class="text-2xl sm:text-3xl font-bold text-center">é ­æ‚ªã„ã‚·ãƒ§ãƒƒãƒ—</h1>
        </div>
    </header>

    <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 flex-grow">
        <p class="mb-6 text-center text-stone-700 md:text-lg">
            ã“ã“ã¯ã€Œé ­æ‚ªã„ã‚·ãƒ§ãƒƒãƒ—ã€ï¼ä¸­å­¦æ ¡ã®å‹é”ã¨ä½œã‚‹ã€æœ€é«˜ã«ãƒã‚«ãƒã‚«ã—ãã¦é¢ç™½ã„ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã®æ©Ÿèƒ½ã‚’ç´¹ä»‹ã™ã‚‹ã‚¬ã‚¤ãƒ‰ã ã‚ˆã€‚
            ç”»é¢å·¦å´ï¼ˆã‚¹ãƒãƒ›ã§ã¯ä¸Šã®æ–¹ï¼‰ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ã€æ°—ã«ãªã‚‹ã€Œã‚¢ãƒ›ãªæ©Ÿèƒ½ã€ã‚’é¸ã‚“ã§ã¿ã¦ã­ï¼è©³ã—ã„èª¬æ˜ãŒå³å´ï¼ˆã‚¹ãƒãƒ›ã§ã¯ä¸‹ã®æ–¹ï¼‰ã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã€‚
        </p>

        <div class="flex flex-col md:flex-row gap-6 md:gap-8">
            <nav id="featuresNav" class="md:w-1/3 lg:w-1/4 bg-amber-100 p-4 sm:p-6 rounded-lg shadow-lg md:sticky md:top-24 self-start">
                <h2 class="text-xl font-semibold text-orange-700 mb-4 border-b-2 border-amber-300 pb-2">ã‚¢ãƒ›ãªæ©Ÿèƒ½ä¸€è¦§</h2>
                <ul id="navList" class="space-y-2">
                </ul>
            </nav>

            <main id="featureDetail" class="md:w-2/3 lg:w-3/4 bg-white p-6 sm:p-8 rounded-lg shadow-xl content-transition min-h-[300px]">
                <div id="initialMessage" class="text-center text-stone-600">
                    <p class="text-lg">ã‚¢ãƒ›ãªæ©Ÿèƒ½ã‚’é¸ã‚“ã§ã¿ã¦ã­ï¼</p>
                    <p class="mt-2 text-2xl">ğŸ¤ª</p>
                </div>
                <div id="featureContent" class="hidden">
                    <h2 id="featureTitle" class="text-2xl sm:text-3xl font-bold text-orange-700 mb-6 border-b-2 border-orange-200 pb-3"></h2>
                    <div class="prose prose-stone max-w-none">
                        <div id="featureIntro" class="mb-6 p-4 bg-orange-50 rounded-md border border-orange-200 text-sm sm:text-base"></div>
                        <h3 class="text-xl font-semibold text-amber-600 mb-2">ğŸ“ å†…å®¹</h3>
                        <p id="featureDescription" class="mb-6 text-base sm:text-lg leading-relaxed"></p>
                        <h3 class="text-xl font-semibold text-amber-600 mb-2">ğŸŒŸ ãƒ¡ãƒªãƒƒãƒˆ</h3>
                        <p id="featureBenefits" class="mb-6 text-base sm:text-lg leading-relaxed"></p>
                    </div>
                    <div id="llmFeatureSection" class="mt-8 pt-6 border-t-2 border-orange-100 hidden">
                        <h3 id="llmFeatureTitle" class="text-xl font-semibold text-orange-700 mb-4"></h3>
                        <div id="llmInputArea" class="mb-4"></div>
                        <div id="llmOutputArea" class="mt-4 p-4 bg-amber-50 rounded-md border border-amber-200 text-stone-700 whitespace-pre-wrap min-h-[100px] flex items-center justify-center text-sm italic">
                            ã“ã“ã«AIã«ã‚ˆã‚‹ç”ŸæˆçµæœãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã€‚
                        </div>
                    </div>
                    <div id="pollSection" class="mt-8 pt-6 border-t-2 border-orange-100 hidden">
                        <h3 class="text-xl font-semibold text-orange-700 mb-4">ğŸ“Š ä»Šæ—¥ã®ã€Œã©ã£ã¡ãŒã‚¢ãƒ›ï¼Ÿã€æŠ•ç¥¨</h3>
                        <div id="pollDisplay" class="mb-4 p-4 bg-orange-50 rounded-md border border-orange-200">
                            <p id="pollQuestion" class="text-lg font-semibold text-stone-800 mb-4 text-center"></p>
                            <div id="pollOptions" class="flex flex-col sm:flex-row justify-center gap-4 mb-4">
                                <button id="voteA" class="vote-button flex-1">A: </button>
                                <button id="voteB" class="vote-button flex-1">B: </button>
                            </div>
                            <div id="pollResults" class="hidden mt-4">
                                <p class="text-center text-stone-700 font-semibold mb-2">æŠ•ç¥¨çµæœ:</p>
                                <div class="flex items-center mb-2">
                                    <span id="optionALabel" class="w-1/4 text-right pr-2 text-stone-700 font-medium"></span>
                                    <div class="w-3/4 bg-gray-200 rounded-full poll-result-bar-container">
                                        <div id="resultA" class="bg-blue-500 poll-result-bar" style="width: 0%;"></div>
                                    </div>
                                    <span id="percentageA" class="w-1/6 text-left pl-2 text-stone-700 font-medium">0%</span>
                                </div>
                                <div class="flex items-center">
                                    <span id="optionBLabel" class="w-1/4 text-right pr-2 text-stone-700 font-medium"></span>
                                    <div class="w-3/4 bg-gray-200 rounded-full poll-result-bar-container">
                                        <div id="resultB" class="bg-red-500 poll-result-bar" style="width: 0%;"></div>
                                    </div>
                                    <span id="percentageB" class="w-1/6 text-left pl-2 text-stone-700 font-medium">0%</span>
                                </div>
                                <p id="totalVotes" class="text-center text-sm text-stone-500 mt-4"></p>
                            </div>
                            <p id="pollStatusMessage" class="text-center text-sm text-stone-600 mt-2"></p>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <footer class="bg-amber-500 text-white py-6 mt-auto">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <p>&copy; 2024 é ­æ‚ªã„ã‚·ãƒ§ãƒƒãƒ— ä¼ç”»éƒ¨</p>
        </div>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, serverTimestamp, deleteDoc, doc, getDoc, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const featuresData = [
            {
                id: "profile",
                name: "ã‚¢ãƒ›ãªãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å¸³",
                icon: "ğŸ¤ª",
                description: "ä¸­å­¦æ ¡ã®å‹é”ã¿ã‚“ãªã®ã€Œæœ€é«˜ã«ã‚¢ãƒ›ãªã¨ã“ã‚ã€ã‚„ã€Œæœ€è¿‘ã‚„ã‚‰ã‹ã—ãŸçˆ†ç¬‘å¤±æ•—è«‡ã€ã‚’è‡ªç”±ã«æ›¸ã‘ã‚‹ãƒšãƒ¼ã‚¸ã ã‚ˆã€‚å¤‰é¡”å†™çœŸã¨ã‹ã€ãŠã‚‚ã—ã‚ã„ã‚¤ãƒ©ã‚¹ãƒˆã‚‚è¼‰ã›ã‚‹ã¨ã€ã‚‚ã£ã¨å€‹æ€§ãŒå…‰ã‚‹ã­ï¼",
                benefits: "ä¸­å­¦æ ¡ã®å‹é”ã®ã€Œæ„å¤–ãªã‚¢ãƒ›ãªä¸€é¢ã€ã‚’çŸ¥ã£ã¦ã€ã¿ã‚“ãªã§å¤§ç¬‘ã„ã§ãã‚‹ã‚ˆã€‚æ–°ã—ã„ã‚ã åãŒç”Ÿã¾ã‚Œã‚‹ã‹ã‚‚ï¼ï¼Ÿ"
            },
            {
                id: "daily_updates",
                name: "ä»Šæ—¥ã®ãƒã‚«ãƒã‚«ã—ã„ã¤ã¶ã‚„ã",
                icon: "ğŸ’¬",
                description: "AIãŒãƒ©ãƒ³ãƒ€ãƒ ã«ã€Œä»Šæ—¥ã®ãƒã‚«ãƒã‚«ã—ã„ã¤ã¶ã‚„ãã€ã‚’ç”Ÿæˆã—ã¦ãã‚Œã‚‹ã‚ˆï¼ã€Œãˆã€ãªã«ã“ã‚Œï¼ï¼Ÿã€ã£ã¦æ€ã‚ãšç¬‘ã£ã¡ã‚ƒã†ã‚ˆã†ãªã€æ„å‘³ä¸æ˜ã ã‘ã©é¢ç™½ã„ä¸€è¨€ãŒå‡ºã¦ãã‚‹ã‹ã‚‚ã€‚",
                benefits: "ä¸­å­¦æ ¡ã®å‹é”ã¿ã‚“ãªã§ã€Œä»Šæ—¥ã®ã¤ã¶ã‚„ãã€ä½•ã‹ãªï¼Ÿã€ã£ã¦æ¯æ—¥è¦‹ã«æ¥ã‚‹ã®ãŒæ¥½ã—ã¿ã«ãªã‚‹ã‚ˆã€‚AIã®äºˆæ¸¬ä¸èƒ½ãªãƒã‚«ãƒã‚«ã—ã•ã«ã€ãã£ã¨æ¯æ—¥ç¬‘é¡”ã«ãªã‚Œã‚‹ã¯ãšï¼"
            },
            {
                id: "calendar",
                name: "ã‚¢ãƒ›ãªã‚¤ãƒ™ãƒ³ãƒˆè¨ˆç”»ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼",
                icon: "ğŸ—“ï¸",
                description: "ä¸­å­¦æ ¡ã®å‹é”ã¿ã‚“ãªã§ã€Œå¤‰ãªTã‚·ãƒ£ãƒ„ç€ã¦é›†ã¾ã‚ã†ï¼ã€ã€Œå…¬åœ’ã§å¤§å£°å¤§ä¼šã—ã‚ˆã†ï¼ã€ã¿ãŸã„ãªã€ã¡ã‚‡ã£ã¨å¤‰ã‚ã£ãŸã‚¤ãƒ™ãƒ³ãƒˆã®äºˆå®šã‚’å…±æœ‰ã™ã‚‹ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã€‚ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼æ©Ÿèƒ½ãŒã‚ã‚Œã°ã€å¿˜ã‚Œç‰©ã‚¼ãƒ­ã‚’ç›®æŒ‡ã›ã‚‹ã‹ã‚‚ï¼",
                benefits: "ä¸­å­¦æ ¡ã®å‹é”ã¨ã®é¢ç™½ã„ã‚¤ãƒ™ãƒ³ãƒˆãŒä¼ç”»ã—ã‚„ã™ããªã‚‹ã‚ˆã€‚ã¿ã‚“ãªã§ã€Œãƒã‚«ãªã“ã¨ã€ã‚’ã—ã¦ã€æœ€é«˜ã®æ€ã„å‡ºã‚’ä½œã‚ã†ï¼"
            },
            {
                id: "study_card",
                name: "çˆ†ç¬‘ï¼æš—è¨˜ã‚«ãƒ¼ãƒ‰ãƒ¡ãƒ¼ã‚«ãƒ¼",
                icon: "ğŸ§ ",
                description: "ãƒ†ã‚¹ãƒˆã«å‡ºãã†ãªå˜èªã‚„å…¬å¼ã‚’ã€ä¸­å­¦æ ¡ã®å‹é”ã¿ã‚“ãªã§ã€Œã‚¢ãƒ›ãªä¾‹æ–‡ã€ã‚„ã€Œå¤‰ãªã‚¤ãƒ©ã‚¹ãƒˆã€ä»˜ãã®æš—è¨˜ã‚«ãƒ¼ãƒ‰ã«ã§ãã‚‹æ©Ÿèƒ½ã ã‚ˆã€‚ã“ã‚Œã§ãƒã‚«ãƒã‚«ã—ãæš—è¨˜ã—ã‚ˆã†ï¼",
                benefits: "ãƒã‚«ãƒã‚«ã—ã„ä¾‹æ–‡ã‚„çµµã§è¦šãˆã‚‹ã‹ã‚‰ã€é ­ã«æ®‹ã‚‹ã¯ãšï¼ä¸­å­¦æ ¡ã®å‹é”ã¿ã‚“ãªã§ä½œã£ãŸã‚«ãƒ¼ãƒ‰ã‚’è¦‹ã¦ç¬‘ã„ãªãŒã‚‰ã€ã„ã¤ã®é–“ã«ã‹æš—è¨˜ã§ãã¡ã‚ƒã†ã‹ã‚‚ï¼ï¼Ÿ"
            },
            {
                id: "stupid_advice",
                name: "ã‚¢ãƒ›ãªæ‚©ã¿ç›¸è«‡å®¤",
                icon: "ğŸ’¡",
                description: "ä¸­å­¦æ ¡ã®å‹é”ã¿ã‚“ãªã®ã€Œã©ã†ã§ã‚‚ã„ã„æ‚©ã¿ã€ã‚„ã€Œã¡ã‚‡ã£ã¨å›°ã£ãŸã“ã¨ã€ã‚’å…¥åŠ›ã™ã‚‹ã¨ã€AIãŒã€Œé ­æ‚ªã„ã‚·ãƒ§ãƒƒãƒ—ã€ã«ãµã•ã‚ã—ã„ã€ãƒ¦ãƒ‹ãƒ¼ã‚¯ã§ç¬‘ãˆã‚‹è§£æ±ºç­–ã‚’ææ¡ˆã—ã¦ãã‚Œã‚‹ã‚ˆã€‚çœŸé¢ç›®ã«è€ƒãˆã™ããšã€AIã®ãƒã‚«ãƒã‚«ã—ã„ã‚¢ã‚¤ãƒ‡ã‚¢ã«ç¬‘ã£ã¦å…ƒæ°—ã‚’å‡ºãã†ï¼",
                benefits: "ã©ã‚“ãªæ‚©ã¿ã‚‚ã€AIã®ã€Œã‚¢ãƒ›ãªè§£æ±ºç­–ã€ã§ç¬‘ã„é£›ã°ã›ã‚‹ã‚ˆã†ã«ãªã‚‹ã‚ˆï¼æ·±åˆ»ãªæ‚©ã¿ã‚‚ã€ã¡ã‚‡ã£ã¨è¦–ç‚¹ã‚’å¤‰ãˆã¦é¢ç™½ãè€ƒãˆã‚‰ã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹ã‹ã‚‚ï¼ï¼Ÿ"
            },
            {
                id: "poll",
                name: "ã©ã£ã¡ãŒã‚¢ãƒ›ï¼ŸæŠ•ç¥¨",
                icon: "ğŸ“Š",
                description: "æ¯æ—¥ã€AIãŒè€ƒãˆãŸï¼ˆã¾ãŸã¯ã‚ã‚‰ã‹ã˜ã‚ç”¨æ„ã•ã‚ŒãŸï¼‰æ–°ã—ã„ã€Œã©ã£ã¡ãŒã‚¢ãƒ›ï¼Ÿã€ãªè³ªå•ãŒç™»å ´ã™ã‚‹ã‚ˆï¼æŠ•ç¥¨ã™ã‚‹ã¨ã€ã™ãã«ã¿ã‚“ãªã®æŠ•ç¥¨çµæœï¼ˆAã¨Bã®å‰²åˆï¼‰ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚“ã ã€‚",
                benefits: "æ¯æ—¥æ–°ã—ã„ã€Œã‚¢ãƒ›ãªé¸æŠã€ã«æŒ‘æˆ¦ã§ãã¦ã€é£½ããšã«æ¥½ã—ã‚ã‚‹ã‚ˆã€‚ã¿ã‚“ãªã®ã€Œã‚¢ãƒ›ãªæ„è¦‹ã€ãŒé›†ã¾ã£ã¦ã€æ„å¤–ãªçµæœã«çˆ†ç¬‘ã§ãã‚‹ã“ã¨é–“é•ã„ãªã—ï¼"
            }
        ];

        // ã©ã£ã¡ãŒã‚¢ãƒ›ï¼ŸæŠ•ç¥¨ ã®è³ªå•ãƒªã‚¹ãƒˆ
        const pollQuestions = [
            { question: "ãƒ†ã‚¹ãƒˆå‹‰å¼·ã™ã‚‹ãªã‚‰ã€é‰›ç­†ã®èŠ¯ã‚’é£Ÿã¹ã‚‹ã®ã¨ã€æ¶ˆã—ã‚´ãƒ ã‚’é£Ÿã¹ã‚‹ã®ã€ã©ã£ã¡ãŒã‚¢ãƒ›ï¼Ÿ", optionA: "é‰›ç­†ã®èŠ¯", optionB: "æ¶ˆã—ã‚´ãƒ " },
            { question: "å­¦æ ¡ã«æŒã£ã¦ã„ããªã‚‰ã€å·¨å¤§ãªãƒ–ãƒ­ãƒƒã‚³ãƒªãƒ¼ã¨ã€å–‹ã‚‹çŸ³ã€ã©ã£ã¡ãŒã‚¢ãƒ›ï¼Ÿ", optionA: "å·¨å¤§ãƒ–ãƒ­ãƒƒã‚³ãƒªãƒ¼", optionB: "å–‹ã‚‹çŸ³" },
            { question: "ä¸€æ—¥ä¸­ã€é€†ç«‹ã¡ã§ç”Ÿæ´»ã™ã‚‹ã®ã¨ã€ã‚«ã‚¨ãƒ«èªã—ã‹å–‹ã‚Œãªããªã‚‹ã®ã€ã©ã£ã¡ãŒã‚¢ãƒ›ï¼Ÿ", optionA: "é€†ç«‹ã¡ç”Ÿæ´»", optionB: "ã‚«ã‚¨ãƒ«èª" },
            { question: "å¯ã‚‹å‰ã«ã€é´ä¸‹ã‚’å±¥ã„ãŸã¾ã¾å¯ã‚‹ã®ã¨ã€æ­¯ãƒ–ãƒ©ã‚·ã‚’ãã‚ãˆãŸã¾ã¾å¯ã‚‹ã®ã€ã©ã£ã¡ãŒã‚¢ãƒ›ï¼Ÿ", optionA: "é´ä¸‹å±¥ã„ãŸã¾ã¾å¯ã‚‹", optionB: "æ­¯ãƒ–ãƒ©ã‚·ãã‚ãˆãŸã¾ã¾å¯ã‚‹" },
            { question: "é€æ˜äººé–“ã«ãªã‚Œã‚‹ã‘ã©ã€ãŠãªã‚‰ã®éŸ³ã ã‘ã¯ä¸–ç•Œä¸­ã«éŸ¿ãæ¸¡ã‚‹ã®ã¨ã€ç©ºã‚’é£›ã¹ã‚‹ã‘ã©ã€å¸¸ã«é¼»æ­Œã‚’æ­Œã£ã¦ã—ã¾ã†ã®ã€ã©ã£ã¡ãŒã‚¢ãƒ›ï¼Ÿ", optionA: "é€æ˜äººé–“ï¼‹ãŠãªã‚‰", optionB: "ç©ºé£›ã¶ï¼‹é¼»æ­Œ" },
            { question: "çµ¦é£Ÿã§ã€æ¯æ—¥ã‚«ãƒ¬ãƒ¼ã ã‘ã©å…·ã¯ã‚°ãƒŸã¨ã€æ¯æ—¥ãƒ©ãƒ¼ãƒ¡ãƒ³ã ã‘ã©éººã¯è¼ªã‚´ãƒ ã€ã©ã£ã¡ãŒã‚¢ãƒ›ï¼Ÿ", optionA: "ã‚°ãƒŸã‚«ãƒ¬ãƒ¼", optionB: "è¼ªã‚´ãƒ ãƒ©ãƒ¼ãƒ¡ãƒ³" },
            { question: "ã‚¿ã‚¤ãƒ ã‚¹ãƒªãƒƒãƒ—ã™ã‚‹ãªã‚‰ã€ç¸„æ–‡æ™‚ä»£ã«ã‚¹ãƒãƒ›ã‚’æŒã£ã¦ã„ãã®ã¨ã€æœªæ¥ã«åœŸå™¨ã‚’æŒã£ã¦ã„ãã®ã€ã©ã£ã¡ãŒã‚¢ãƒ›ï¼Ÿ", optionA: "ç¸„æ–‡ã«ã‚¹ãƒãƒ›", optionB: "æœªæ¥ã«åœŸå™¨" },
            { question: "ä¸€é€±é–“ã€ãšã£ã¨ã‚¹ã‚­ãƒƒãƒ—ã§ç§»å‹•ã™ã‚‹ã®ã¨ã€èªå°¾ã«ã€Œã€œã ãƒ‰ãƒ³ï¼ã€ã¨ã¤ã‘ã¦å–‹ã‚‹ã®ã€ã©ã£ã¡ãŒã‚¢ãƒ›ï¼Ÿ", optionA: "ã‚¹ã‚­ãƒƒãƒ—ç§»å‹•", optionB: "èªå°¾ã€Œã€œã ãƒ‰ãƒ³ï¼ã€" },
            { question: "è‡ªåˆ†ã®å£°ãŒã€å¸¸ã«ã‚¢ãƒ‹ãƒ¡ã‚­ãƒ£ãƒ©ã®å£°ã«ãªã‚‹ã®ã¨ã€å¸¸ã«åŠ¹æœéŸ³ï¼ˆä¾‹ï¼šãƒ”ã‚³ãƒ¼ãƒ³ï¼ï¼‰ã«ãªã‚‹ã®ã€ã©ã£ã¡ãŒã‚¢ãƒ›ï¼Ÿ", optionA: "ã‚¢ãƒ‹ãƒ¡ã‚­ãƒ£ãƒ©ã®å£°", optionB: "åŠ¹æœéŸ³" },
            { question: "ãƒ†ã‚¹ãƒˆä¸­ã«ã€éš£ã®å¸­ã®å‹é”ãŒæ€¥ã«è¸Šã‚Šå‡ºã™ã®ã¨ã€å…ˆç”ŸãŒæ€¥ã«æ­Œã„å‡ºã™ã®ã€ã©ã£ã¡ãŒã‚¢ãƒ›ï¼Ÿ", optionA: "å‹é”ãŒè¸Šã‚Šå‡ºã™", optionB: "å…ˆç”ŸãŒæ­Œã„å‡ºã™" }
        ];


        const navList = document.getElementById('navList');
        const featureDetail = document.getElementById('featureDetail');
        const initialMessage = document.getElementById('initialMessage');
        const featureContent = document.getElementById('featureContent');
        const featureTitle = document.getElementById('featureTitle');
        const featureIntro = document.getElementById('featureIntro');
        const featureDescription = document.getElementById('featureDescription');
        const featureBenefits = document.getElementById('featureBenefits');
        const llmFeatureSection = document.getElementById('llmFeatureSection');
        const llmFeatureTitle = document.getElementById('llmFeatureTitle');
        const llmInputArea = document.getElementById('llmInputArea');
        const llmOutputArea = document.getElementById('llmOutputArea');
        const pollSection = document.getElementById('pollSection');
        const pollQuestionElement = document.getElementById('pollQuestion');
        const voteAButton = document.getElementById('voteA');
        const voteBButton = document.getElementById('voteB');
        const pollResultsDiv = document.getElementById('pollResults');
        const optionALabel = document.getElementById('optionALabel');
        const optionBLabel = document.getElementById('optionBLabel');
        const resultA = document.getElementById('resultA');
        const resultB = document.getElementById('resultB');
        const percentageA = document.getElementById('percentageA');
        const percentageB = document.getElementById('percentageB');
        const totalVotesElement = document.getElementById('totalVotes');
        const pollStatusMessage = document.getElementById('pollStatusMessage');


        let currentActiveNavItem = null;
        let db;
        let auth;
        let userId;
        let appId;
        let currentPollIndex;
        let currentPollDateId; // YYYYMMDDå½¢å¼

        // FirebaseåˆæœŸåŒ–ã¨èªè¨¼
        document.addEventListener('DOMContentLoaded', async () => {
            appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
            const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');

            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }

                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        userId = user.uid;
                        console.log("Firebase initialized and authenticated. User ID:", userId);
                    } else {
                        console.log("No user signed in.");
                    }
                });

            } catch (error) {
                console.error("Firebase initialization or authentication error:", error);
            }
        });

        // ä»Šæ—¥ã®æ—¥ä»˜ã«åŸºã¥ã„ã¦æŠ•ç¥¨è³ªå•ã‚’é¸æŠã™ã‚‹
        function getDailyPoll() {
            const today = new Date();
            const startOfYear = new Date(today.getFullYear(), 0, 1);
            const diff = today.getTime() - startOfYear.getTime();
            const oneDay = 1000 * 60 * 60 * 24;
            const dayOfYear = Math.floor(diff / oneDay);
            
            currentPollIndex = dayOfYear % pollQuestions.length;
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            currentPollDateId = `${year}${month}${day}`;

            return pollQuestions[currentPollIndex];
        }

        // æŠ•ç¥¨çµæœã‚’Firestoreã‹ã‚‰ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§å–å¾—ãƒ»è¡¨ç¤º
        function setupPollListener() {
            if (!db || !userId) {
                console.warn("Firestore or User ID not available for poll listener setup.");
                return;
            }

            const pollDocRef = doc(db, `artifacts/${appId}/public/data/daily_poll_results`, `poll_results_${currentPollDateId}`);
            const userVoteDocRef = doc(db, `artifacts/${appId}/users/${userId}/daily_votes_tracker`, `vote_status_${currentPollDateId}`);

            onSnapshot(pollDocRef, (docSnap) => {
                let votesA = 0;
                let votesB = 0;
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    votesA = data.votesA || 0;
                    votesB = data.votesB || 0;
                }
                updatePollResultsDisplay(votesA, votesB);
            }, (error) => {
                console.error("Error listening to poll results:", error);
                pollStatusMessage.textContent = 'æŠ•ç¥¨çµæœã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚';
            });

            // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æŠ•ç¥¨çŠ¶æ³ã‚’ãƒã‚§ãƒƒã‚¯
            onSnapshot(userVoteDocRef, (docSnap) => {
                if (docSnap.exists() && docSnap.data().voted) {
                    disableVotingButtons(true);
                    pollStatusMessage.textContent = `ä»Šæ—¥ã¯ã‚‚ã†æŠ•ç¥¨ã—ãŸã‚ˆï¼ (${docSnap.data().votedOption}ã«æŠ•ç¥¨)`;
                } else {
                    disableVotingButtons(false);
                    pollStatusMessage.textContent = 'ã©ã¡ã‚‰ãŒã‚¢ãƒ›ã‹ã€æŠ•ç¥¨ã—ã¦ã­ï¼';
                }
            }, (error) => {
                console.error("Error checking user vote status:", error);
                pollStatusMessage.textContent = 'æŠ•ç¥¨çŠ¶æ³ã®ç¢ºèªã«å¤±æ•—ã—ã¾ã—ãŸã€‚';
            });
        }

        // æŠ•ç¥¨çµæœã®è¡¨ç¤ºã‚’æ›´æ–°ã™ã‚‹
        function updatePollResultsDisplay(votesA, votesB) {
            const totalVotes = votesA + votesB;
            const percentageAValue = totalVotes === 0 ? 0 : (votesA / totalVotes) * 100;
            const percentageBValue = totalVotes === 0 ? 0 : (votesB / totalVotes) * 100;

            resultA.style.width = `${percentageAValue}%`;
            resultB.style.width = `${percentageBValue}%`;
            percentageA.textContent = `${percentageAValue.toFixed(0)}%`;
            percentageB.textContent = `${percentageBValue.toFixed(0)}%`;
            totalVotesElement.textContent = `åˆè¨ˆæŠ•ç¥¨æ•°: ${totalVotes}`;

            pollResultsDiv.classList.remove('hidden');
        }

        // æŠ•ç¥¨ãƒœã‚¿ãƒ³ã®æœ‰åŠ¹/ç„¡åŠ¹ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹
        function disableVotingButtons(disabled) {
            voteAButton.disabled = disabled;
            voteBButton.disabled = disabled;
        }

        // æŠ•ç¥¨å‡¦ç†
        async function handleVote(option) {
            if (!db || !userId) {
                pollStatusMessage.textContent = 'ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒæº–å‚™ã§ãã¦ãªã„ã¿ãŸã„...ã¡ã‚‡ã£ã¨å¾…ã£ã¦ã­ï¼';
                return;
            }

            const pollDocRef = doc(db, `artifacts/${appId}/public/data/daily_poll_results`, `poll_results_${currentPollDateId}`);
            const userVoteDocRef = doc(db, `artifacts/${appId}/users/${userId}/daily_votes_tracker`, `vote_status_${currentPollDateId}`);

            // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ—¢ã«æŠ•ç¥¨ã—ã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
            const userVoteSnap = await getDoc(userVoteDocRef);
            if (userVoteSnap.exists() && userVoteSnap.data().voted) {
                pollStatusMessage.textContent = `ä»Šæ—¥ã¯ã‚‚ã†æŠ•ç¥¨ã—ãŸã‚ˆï¼ (${userVoteSnap.data().votedOption}ã«æŠ•ç¥¨æ¸ˆã¿)`;
                disableVotingButtons(true);
                return;
            }

            try {
                // å…¬é–‹æŠ•ç¥¨çµæœã‚’æ›´æ–° (increment)
                await setDoc(pollDocRef, {
                    questionIndex: currentPollIndex,
                    votesA: option === 'A' ? (await getDoc(pollDocRef)).data()?.votesA + 1 || 1 : (await getDoc(pollDocRef)).data()?.votesA || 0,
                    votesB: option === 'B' ? (await getDoc(pollDocRef)).data()?.votesB + 1 || 1 : (await getDoc(pollDocRef)).data()?.votesB || 0,
                }, { merge: true }); // merge: true ã§æ—¢å­˜ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯ä¸Šæ›¸ãã›ãšã€æŒ‡å®šãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã¿æ›´æ–°

                // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æŠ•ç¥¨çŠ¶æ³ã‚’è¨˜éŒ²
                await setDoc(userVoteDocRef, {
                    voted: true,
                    votedOption: option,
                    timestamp: serverTimestamp()
                });

                pollStatusMessage.textContent = `${option}ã«æŠ•ç¥¨ã—ãŸã‚ˆï¼ã‚ã‚ŠãŒã¨ã†ï¼`;
                disableVotingButtons(true); // æŠ•ç¥¨å¾Œã¯ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
            } catch (e) {
                console.error("Error voting:", e);
                pollStatusMessage.textContent = 'æŠ•ç¥¨ã«å¤±æ•—ã—ã¡ã‚ƒã£ãŸã¿ãŸã„ã€‚ã‚‚ã†ä¸€åº¦è©¦ã—ã¦ã¿ã¦ã­ï¼';
            }
        }

        voteAButton.onclick = () => handleVote('A');
        voteBButton.onclick = () => handleVote('B');


        async function callGeminiAPI(prompt) {
            llmOutputArea.textContent = 'AIãŒã‚¢ã‚¤ãƒ‡ã‚¢ã‚’ç”Ÿæˆä¸­... âœ¨ ã¡ã‚‡ã£ã¨å¾…ã£ã¦ã­ï¼';
            llmOutputArea.classList.add('animate-pulse');

            let chatHistory = [];
            chatHistory.push({ role: "user", parts: [{ text: prompt }] });
            const payload = { contents: chatHistory };
            const apiKey = ""; 
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    llmOutputArea.textContent = text;
                } else {
                    llmOutputArea.textContent = 'ã‚¢ã‚¤ãƒ‡ã‚¢ã®ç”Ÿæˆã«å¤±æ•—ã—ã¡ã‚ƒã£ãŸã¿ãŸã„ã€‚ã‚‚ã†ä¸€åº¦è©¦ã—ã¦ã¿ã¦ã­ï¼';
                }
            } catch (error) {
                console.error('Gemini API Error:', error);
                llmOutputArea.textContent = 'ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã®èª¿å­ãŒæ‚ªã„ã¿ãŸã„ã€‚ã‚‚ã†ä¸€åº¦è©¦ã—ã¦ã¿ã¦ã­ï¼';
            } finally {
                llmOutputArea.classList.remove('animate-pulse');
            }
        }

        function generateSelfIntroIdeas() {
            llmOutputArea.textContent = 'ã“ã“ã«AIã«ã‚ˆã‚‹ç”ŸæˆçµæœãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã€‚';
            const interestsInput = document.getElementById('profileInterests');
            const interests = interestsInput ? interestsInput.value : '';
            const prompt = `ä¸­å­¦æ ¡ã®å‹é”å‘ã‘ã®ã€Œé ­æ‚ªã„ã‚·ãƒ§ãƒƒãƒ—ã€ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã§ä½¿ã†è‡ªå·±ç´¹ä»‹æ–‡ã®ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’ã„ãã¤ã‹ææ¡ˆã—ã¦ãã ã•ã„ã€‚å¥½ããªã“ã¨ã‚„è¶£å‘³ãŒã€Œ${interests}ã€ã§ã™ã€‚ä¸­å­¦ç”Ÿã«ã‚ã‹ã‚Šã‚„ã™ãã€ãƒã‚«ãƒã‚«ã—ãã¦é¢ç™½ã„ãƒˆãƒ¼ãƒ³ã§ã€ç®‡æ¡æ›¸ãã§3ã¤ã»ã©ææ¡ˆã—ã¦ãã ã•ã„ã€‚`;
            callGeminiAPI(prompt);
        }

        function suggestEventIdeas() {
            llmOutputArea.textContent = 'ã“ã“ã«AIã«ã‚ˆã‚‹ç”ŸæˆçµæœãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã€‚';
            const eventContextInput = document.getElementById('eventContext');
            const context = eventContextInput ? eventContextInput.value : '';
            const prompt = `ä¸­å­¦æ ¡ã®å‹é”ã¨ã®é›†ã¾ã‚Šã§ç››ã‚Šä¸ŠãŒã‚‹ã€Œé ­æ‚ªã„ã‚·ãƒ§ãƒƒãƒ—ã€ã«ãµã•ã‚ã—ã„ã‚¤ãƒ™ãƒ³ãƒˆã®ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’ã„ãã¤ã‹ææ¡ˆã—ã¦ãã ã•ã„ã€‚ç¾åœ¨ã®çŠ¶æ³ã‚„å¸Œæœ›ã¯ã€Œ${context}ã€ã§ã™ã€‚ä¸­å­¦ç”ŸãŒæ¥½ã—ã‚ã‚‹ã‚ˆã†ãªã€ãƒ¦ãƒ‹ãƒ¼ã‚¯ã§ã‚¢ãƒ›ãªã‚¢ã‚¤ãƒ‡ã‚¢ã‚’ç®‡æ¡æ›¸ãã§3ã¤ã»ã©ææ¡ˆã—ã¦ãã ã•ã„ã€‚`;
            callGeminiAPI(prompt);
        }

        function generateStudyCardExample() {
            llmOutputArea.textContent = 'ã“ã“ã«AIã«ã‚ˆã‚‹ç”ŸæˆçµæœãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã€‚';
            const wordInput = document.getElementById('studyWord');
            const word = wordInput ? wordInput.value : '';
            const prompt = `ä¸­å­¦æ ¡ã®ãƒ†ã‚¹ãƒˆå‹‰å¼·ç”¨ã®ã€Œã‚¢ãƒ›ãªæš—è¨˜ã‚«ãƒ¼ãƒ‰ã€ã‚’ä½œã‚ŠãŸã„ã§ã™ã€‚å˜èªã‚„å¹´å·ã€Œ${word}ã€ã‚’ä½¿ã£ã¦ã€ä¸­å­¦ç”ŸãŒçˆ†ç¬‘ã—ã¦è¨˜æ†¶ã«æ®‹ã‚‹ã‚ˆã†ãªã€ãƒã‚«ãƒã‚«ã—ã„ä¾‹æ–‡ã‚’1ã¤ææ¡ˆã—ã¦ãã ã•ã„ã€‚ä¾‹æ–‡ã®å¾Œã«ã€ãã®å˜èªã®å¤‰ãªã‚¤ãƒ¡ãƒ¼ã‚¸ã‚¤ãƒ©ã‚¹ãƒˆã®ã‚¢ã‚¤ãƒ‡ã‚¢ã‚‚1ã¤ææ¡ˆã—ã¦ãã ã•ã„ã€‚`;
            callGeminiAPI(prompt);
        }

        function solveStupidProblem() {
            llmOutputArea.textContent = 'ã“ã“ã«AIã«ã‚ˆã‚‹ç”ŸæˆçµæœãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã€‚';
            const problemInput = document.getElementById('stupidProblem');
            const problem = problemInput ? problemInput.value : '';
            const prompt = `ä¸­å­¦ç”Ÿå‘ã‘ã®ã€Œé ­æ‚ªã„ã‚·ãƒ§ãƒƒãƒ—ã€ã®æ‚©ã¿ç›¸è«‡å®¤ã§ã™ã€‚ä»¥ä¸‹ã®æ‚©ã¿ã«å¯¾ã—ã¦ã€ã‚ã¡ã‚ƒãã¡ã‚ƒã§ã€ã¡ã‚‡ã£ã¨ãƒã‚«ãƒã‚«ã—ã„ã‘ã©ã€ãªãœã‹ç¬‘ãˆã¦ã—ã¾ã†ã‚ˆã†ãªã€Œã‚¢ãƒ›ãªè§£æ±ºç­–ã€ã‚’3ã¤ææ¡ˆã—ã¦ãã ã•ã„ã€‚çœŸé¢ç›®ã™ããšã€ãƒ¦ãƒ¼ãƒ¢ã‚¢ã‚’äº¤ãˆã¦ãŠé¡˜ã„ã—ã¾ã™ã€‚æ‚©ã¿: ${problem}`;
            callGeminiAPI(prompt);
        }

        function generateRandomStupidTweet() {
            llmOutputArea.textContent = 'ã“ã“ã«AIã«ã‚ˆã‚‹ç”ŸæˆçµæœãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã€‚';
            const prompt = `ä¸­å­¦æ ¡ã®å‹é”å‘ã‘ã®ã€Œé ­æ‚ªã„ã‚·ãƒ§ãƒƒãƒ—ã€ã§ã€ãƒ©ãƒ³ãƒ€ãƒ ã«è¡¨ç¤ºã•ã‚Œã‚‹ã€Œä»Šæ—¥ã®ãƒã‚«ãƒã‚«ã—ã„ã¤ã¶ã‚„ãã€ã‚’1ã¤ææ¡ˆã—ã¦ãã ã•ã„ã€‚çŸ­ãã€æ„å‘³ä¸æ˜ã§ã€æ€ã‚ãšã€Œã¯ï¼Ÿã€ã¨ãªã‚‹ã‚ˆã†ãªã€ã§ã‚‚ã¡ã‚‡ã£ã¨ç¬‘ãˆã‚‹ã¤ã¶ã‚„ãã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚`;
            callGeminiAPI(prompt);
        }

        function displayFeature(featureId) {
            const feature = featuresData.find(f => f.id === featureId);
            if (feature) {
                featureDetail.style.opacity = 0;
                setTimeout(() => {
                    initialMessage.classList.add('hidden');
                    featureContent.classList.remove('hidden');
                    
                    featureTitle.textContent = `${feature.icon} ${feature.name}`;
                    featureIntro.innerHTML = `ã“ã“ã§ã¯ã€Œ<strong>${feature.name}</strong>ã€ã«ã¤ã„ã¦è©³ã—ãè¦‹ã¦ã„ã“ã†ï¼ã©ã‚“ãªå†…å®¹ã§ã€ã©ã‚“ãªãƒ¡ãƒªãƒƒãƒˆãŒã‚ã‚‹ã®ã‹ãªï¼Ÿ`;
                    featureDescription.textContent = feature.description;
                    featureBenefits.textContent = feature.benefits;

                    // Clear previous LLM section content
                    llmFeatureSection.classList.add('hidden');
                    llmInputArea.innerHTML = '';
                    llmOutputArea.textContent = 'ã“ã“ã«AIã«ã‚ˆã‚‹ç”ŸæˆçµæœãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã€‚';
                    llmOutputArea.classList.remove('animate-pulse');

                    // Hide poll section by default
                    pollSection.classList.add('hidden');

                    if (featureId === 'profile') {
                        llmFeatureSection.classList.remove('hidden');
                        llmFeatureTitle.textContent = 'âœ¨ ã‚¢ãƒ›ãªè‡ªå·±ç´¹ä»‹ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’AIã«èã„ã¦ã¿ã‚ˆã†ï¼';
                        llmInputArea.innerHTML = `
                            <label for="profileInterests" class="block text-sm font-medium text-stone-700 mb-2">å¥½ããªã“ã¨ã‚„ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ã­ (ä¾‹: ã‚²ãƒ¼ãƒ ã€æ—…è¡Œã€æ–™ç†)</label>
                            <textarea id="profileInterests" class="w-full p-2 border border-gray-300 rounded-md focus:ring-amber-500 focus:border-amber-500" rows="3" placeholder="ä¾‹: èª­æ›¸ã€æ˜ ç”»é‘‘è³ã€çŒ«å¥½ã"></textarea>
                            <button id="generateProfileIdeasBtn" class="llm-button mt-3 px-6 py-2 rounded-full text-white font-semibold">
                                ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’ç”Ÿæˆï¼
                            </button>
                        `;
                        document.getElementById('generateProfileIdeasBtn').onclick = generateSelfIntroIdeas;
                    } else if (featureId === 'daily_updates') {
                        llmFeatureSection.classList.remove('hidden');
                        llmFeatureTitle.textContent = 'âœ¨ ä»Šæ—¥ã®ãƒã‚«ãƒã‚«ã—ã„ã¤ã¶ã‚„ãã‚’AIã«ç”Ÿæˆã—ã¦ã‚‚ã‚‰ãŠã†ï¼';
                        llmInputArea.innerHTML = `
                            <p class="text-sm text-stone-700 mb-2">ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€AIãŒãƒ©ãƒ³ãƒ€ãƒ ã«ã¤ã¶ã‚„ãã‚’ç”Ÿæˆã™ã‚‹ã‚ˆï¼</p>
                            <button id="generateRandomTweetBtn" class="llm-button mt-3 px-6 py-2 rounded-full text-white font-semibold">
                                ã‚¢ãƒ›ãªã¤ã¶ã‚„ãã‚’ç”Ÿæˆï¼
                            </button>
                        `;
                        document.getElementById('generateRandomTweetBtn').onclick = generateRandomStupidTweet;
                    } else if (featureId === 'calendar') {
                        llmFeatureSection.classList.remove('hidden');
                        llmFeatureTitle.textContent = 'âœ¨ ã‚¢ãƒ›ãªã‚¤ãƒ™ãƒ³ãƒˆã‚¢ã‚¤ãƒ‡ã‚¢ã‚’AIã«ææ¡ˆã—ã¦ã‚‚ã‚‰ãŠã†ï¼';
                        llmInputArea.innerHTML = `
                            <label for="eventContext" class="block text-sm font-medium text-stone-700 mb-2">ã©ã‚“ãªé›†ã¾ã‚Šã«ã—ãŸã„ã‹ã€å¸Œæœ›ã‚„çŠ¶æ³ã‚’å…¥åŠ›ã—ã¦ã­ (ä¾‹: 5äººã§æ”¾èª²å¾Œã€ãŠé‡‘ã‚’ã‹ã‘ãšã«ã€ä½“ã‚’å‹•ã‹ã—ãŸã„)</label>
                            <textarea id="eventContext" class="w-full p-2 border border-gray-300 rounded-md focus:ring-amber-500 focus:border-amber-500" rows="3" placeholder="ä¾‹: ã¿ã‚“ãªã§ãƒ¯ã‚¤ãƒ¯ã‚¤ã€èª•ç”Ÿæ—¥ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼ã€ãƒ†ã‚¹ãƒˆå‹‰å¼·ä¼š"></textarea>
                            <button id="suggestEventIdeasBtn" class="llm-button mt-3 px-6 py-2 rounded-full text-white font-semibold">
                                ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’ææ¡ˆï¼
                            </button>
                        `;
                        document.getElementById('suggestEventIdeasBtn').onclick = suggestEventIdeas;
                    } else if (featureId === 'study_card') {
                        llmFeatureSection.classList.remove('hidden');
                        llmFeatureTitle.textContent = 'âœ¨ AIã«ã‚¢ãƒ›ãªæš—è¨˜ã‚«ãƒ¼ãƒ‰ã®ä¾‹æ–‡ã‚’ææ¡ˆã—ã¦ã‚‚ã‚‰ãŠã†ï¼';
                        llmInputArea.innerHTML = `
                            <label for="studyWord" class="block text-sm font-medium text-stone-700 mb-2">æš—è¨˜ã—ãŸã„å˜èªã‚„å…¬å¼ã‚’å…¥åŠ›ã—ã¦ã­ (ä¾‹: 1603å¹´ å¾³å·å®¶åº·ã€å¯›æ°¸é€šå®)</label>
                            <textarea id="studyWord" class="w-full p-2 border border-gray-300 rounded-md focus:ring-amber-500 focus:border-amber-500" rows="2" placeholder="ä¾‹: 1603å¹´ å¾³å·å®¶åº·ã€å¯›æ°¸é€šå®"></textarea>
                            <button id="generateStudyCardBtn" class="llm-button mt-3 px-6 py-2 rounded-full text-white font-semibold">
                                ä¾‹æ–‡ã‚’ç”Ÿæˆï¼
                            </button>
                        `;
                        document.getElementById('generateStudyCardBtn').onclick = generateStudyCardExample;
                    } else if (featureId === 'stupid_advice') {
                        llmFeatureSection.classList.remove('hidden');
                        llmFeatureTitle.textContent = 'âœ¨ AIã«ã‚¢ãƒ›ãªè§£æ±ºç­–ã‚’ææ¡ˆã—ã¦ã‚‚ã‚‰ãŠã†ï¼';
                        llmInputArea.innerHTML = `
                            <label for="stupidProblem" class="block text-sm font-medium text-stone-700 mb-2">ã‚ãªãŸã®ãã ã‚‰ãªã„æ‚©ã¿ã‚’å…¥åŠ›ã—ã¦ã­ (ä¾‹: æœèµ·ãã‚‹ã®ãŒã¤ã‚‰ã„ã€çµ¦é£Ÿã®ç‰›ä¹³ãŒè‹¦æ‰‹)</label>
                            <textarea id="stupidProblem" class="w-full p-2 border border-gray-300 rounded-md focus:ring-amber-500 focus:border-amber-500" rows="3" placeholder="ä¾‹: å®¿é¡ŒãŒçµ‚ã‚ã‚‰ãªã„ï¼"></textarea>
                            <button id="solveStupidProblemBtn" class="llm-button mt-3 px-6 py-2 rounded-full text-white font-semibold">
                                è§£æ±ºç­–ã‚’ææ¡ˆï¼
                            </button>
                        `;
                        document.getElementById('solveStupidProblemBtn').onclick = solveStupidProblem;
                    } else if (featureId === 'poll') {
                        pollSection.classList.remove('hidden');
                        const dailyPoll = getDailyPoll();
                        pollQuestionElement.textContent = dailyPoll.question;
                        voteAButton.textContent = `A: ${dailyPoll.optionA}`;
                        voteBButton.textContent = `B: ${dailyPoll.optionB}`;
                        optionALabel.textContent = dailyPoll.optionA;
                        optionBLabel.textContent = dailyPoll.optionB;
                        setupPollListener(); // æŠ•ç¥¨ãƒªã‚¹ãƒŠãƒ¼ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
                    }
                    
                    featureDetail.style.opacity = 1;
                }, 150);
            }
        }

        featuresData.forEach(feature => {
            const listItem = document.createElement('li');
            const button = document.createElement('button');
            button.className = 'nav-item w-full text-left px-4 py-2 rounded-md text-stone-700 hover:bg-amber-400 hover:text-amber-800 transition-colors duration-150 ease-in-out text-sm sm:text-base';
            button.textContent = `${feature.icon} ${feature.name}`;
            button.onclick = () => {
                displayFeature(feature.id);
                if (currentActiveNavItem) {
                    currentActiveNavItem.classList.remove('active');
                }
                button.classList.add('active');
                currentActiveNavItem = button;

                // Scroll main content into view on mobile after selection
                if (window.innerWidth < 768) { // md breakpoint
                    featureDetail.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            };
            listItem.appendChild(button);
            navList.appendChild(listItem);
        });

        // Optionally display the first feature by default
        // if (featuresData.length > 0) {
        //    const firstFeatureButton = navList.querySelector('button');
        //    if (firstFeatureButton) {
        //        firstFeatureButton.click();
        //    }
        // }
    </script>
</body>
</html>
